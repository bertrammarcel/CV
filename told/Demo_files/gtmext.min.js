/**
 * Copyright: Trakken GmbH (c) 2023
 * Description: The trking extension to extend trkings like Video, Download etc.
 * Author:   Tobias Grass, Alexander Kunz, Sebastian Pospischil
 * Version:  2.5[2023-02-14 15:35]
 */
var trx_version="2.5[2023-02-14 15:35]";window.trkknSettings=window.trkknSettings||{};window.trkknSettings.trxSettings=gtmCfg;window.trkknSettings.trxVersion='js:'+trx_version+',tpl:'+gtmCfg.tplVersion;var GasHelper=function(){};GasHelper.prototype._addEventListener=function(obj,evt,ofnc,bubble){var fnc=function(event){if(!event||!event.target){event=window.event;event.target=event.srcElement;}
return ofnc.call(obj,event);};if(!isOjectStillTracked(obj)){if(obj.addEventListener){obj.addEventListener(evt,fnc,!!bubble);attachTrackingAttribute(obj);return true;}}};var attachTrackingAttribute=function(obj){if(obj.dataset){obj.dataset["tracked"]='true';}};var isOjectStillTracked=function(obj){var tracked=false;if(obj.dataset){tracked=obj.dataset["tracked"]=="true"?true:false;}
return tracked;};GasHelper.prototype._liveEvent=function(tag,evt,ofunc){var gh=this;tag=tag.toUpperCase();tag=tag.split(',');gh._addEventListener(document,evt,function(me){for(var el=me.target;el.nodeName!=='HTML';el=el.parentNode){if(utls.inArray(tag,el.nodeName)||el.parentNode===null){break;}}
if(el&&utls.inArray(tag,el.nodeName)){ofunc.call(el,me);}},true);};GasHelper.prototype._DOMReady=function(callback){var scp=this;function cb(){if(cb.done)
return;cb.done=true;callback.apply(scp,arguments);}
if(/^(interactive|complete)/.test(document.readyState))
return cb();this._addEventListener(document,'DOMContentLoaded',cb,false);this._addEventListener(window,'load',cb,false);};var sindexOf=String.prototype.indexOf;var slice=Array.prototype.slice;function gautls(){}
gautls.prototype.trkEvent=function(category,action,label,ni,extendedVar,clickVar,value){if(typeof(gtmCfg)!=='undefined'){if(gtmCfg.tagManagement.google){gtmCfg.dataLayer.push({'event':gtmCfg.eNamePrefix+'event','eventCategory':category,'eventLabel':label,'eventAction':action,'eventNi':ni,'extendedVar':extendedVar,'extendedClickId':clickVar,'eventValue':value});if(gtmCfg.debug){console.log("trkEvent:GA3 \t"+category+"|"+action+"|"+label+"|"+ni+"|"+extendedVar+"|"+clickVar);}};if(gtmCfg.tagManagement.adobe){_satellite.track('event',{'eventCategory':category,'eventLabel':label,'eventAction':action,'eventNi':ni,'extendedVar':extendedVar,'extendedClickId':clickVar});if(gtmCfg.debug){console.log("trkEvent:ADOBE \t"+category+"|"+action+"|"+label+"|"+ni+"|"+extendedVar+"|"+clickVar);}}}};gautls.prototype.trkAwEvent=function(obj){if(typeof(gtmCfg)!=='undefined'){if(gtmCfg.tagManagement.ga4){obj.event=obj.event.toLowerCase();var encapObj={};encapObj[obj.event_name_trx]=obj;encapObj.event=obj.event;encapObj["gtm.element"]=obj["gtm.element"];encapObj["gtm.elementClasses"]=obj["gtm.element"].className||"";encapObj["gtm.elementId"]=obj["gtm.element"].id||"";encapObj["gtm.elementTarget"]=obj["gtm.element"].target||obj["gtm.element"].formTarget||"";encapObj["gtm.elementUrl"]=obj["gtm.element"].href||"";encapObj.event_name=obj.event_name_trx;delete encapObj[obj.event_name_trx].event;delete encapObj[obj.event_name_trx]["gtm.element"];delete encapObj[obj.event_name_trx].event_name_trx;gtmCfg.dataLayer.push(encapObj);if(gtmCfg.debug){console.log("trkEvent:GA4");console.log(obj);}}}}
gautls.prototype.trkSocial=function(network,socialAction,target,ni,extendedVar,clickVar){if(gtmCfg.tagManagement.google){gtmCfg.dataLayer.push({'event':gtmCfg.eNamePrefix+'share','socialNetwork':network,'socialAction':socialAction,'socialTarget':target,'eventNi':ni,'extendedVar':extendedVar,'extendedClickId':clickVar});if(gtmCfg.debug){console.log("trkSocial:GA3 \t"+network+"|"+socialAction+"|"+target+"|"+extendedVar+"|"+clickVar);}}};gautls.prototype.qs=function(a,b){var jsParams=[];var scriptParams=decodeURIComponent(a).split("?")[1];if(scriptParams!==undefined){var res=scriptParams.split("&");for(var index=0;index<res.length;++index){var item=res[index].split("=");jsParams[item[0]]=item[1];}}
return jsParams[b];};gautls.prototype.checkFile=function(src,extensions){if(typeof src!=='string'){return false;}
if(typeof extensions==='string'){extensions=extensions.split(',');}
var ext=src.split('?')[0];ext=ext.split('.');ext=ext[ext.length-1];ext=ext.toLowerCase();if(ext&&this.inArray(extensions,ext)){return ext;}
return false;};gautls.prototype.getFormName=function(el){while(el&&el.nodeName!=='HTML'){if(el.nodeName==='FORM'){break;}
el=el.parentNode;}
if(el.nodeName===null){return'null'}
if(el.nodeName!==null&&el.nodeName==='FORM'){return el.getAttribute("name")||el.getAttribute("id")||el.getAttribute("action")||el.getAttribute("class")||'none';}
return'none';};gautls.prototype.inArray=function(obj,item){if(obj&&obj.length){for(var i=0;i<obj.length;i++){if(obj[i]===item){return true;}}}
return false;};trkknSettings.closestElement=function(elem,selector){if(!Element.prototype.matches){Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(s){var matches=(this.document||this.ownerDocument).querySelectorAll(s),i=matches.length;while(--i>=0&&matches.item(i)!==this){}
return i>-1;};}
for(;elem&&elem!==document;elem=elem.parentNode){if(elem.matches(selector)){return elem;}}
return null;};trkknSettings.buildAttributesString=function(elem,clickIdentifier){var clickIdentifier_value="";for(var key in clickIdentifier){if(elem.matches(key)){clickIdentifier_value=clickIdentifier[key];break;}}
var result="";var cisplit=clickIdentifier_value.split("#");var cidentifier=cisplit[0];if(cidentifier!==""){var alsplit=cidentifier.split(">");for(j=0;j<alsplit.length;j++){var elementAttribute=elem.getAttribute(alsplit[j]);if(elementAttribute!==null){if(result!==""){result+=" > ";}
result+=elementAttribute;}}
if(cisplit.length===2){result=cisplit[1]+" > "+result;}
return result;}else{return cisplit[1];}};function trkLinkId(opts){var gh=trkHlp;gh._addEventListener(document,'mousedown',function(e){getLinkId(e,"right_click")},false);gh._addEventListener(document,'keypress',function(e){getLinkId(e,"keypress_enter")},false);if(opts.pageTemplate!==false){document.cookie=opts.cookieName+"=###"+opts.pageTemplate+";path=/;Secure";}
function getLinkId(e,t){if(t==="right_click"||(t==="keypress_enter"&&e.keyCode==13)){if(opts.pushListenerEvents){window.dataLayer.push({"event":t,"gtm.element":e.target||"","gtm.elementClasses":e.target.className||"","gtm.elementId":e.target.id||"","gtm.elementTarget":e.target.target||e.target.formTarget||"","gtm.elementUrl":e.target.href||""});}
var clickedParent=trkknSettings.closestElement(e.target,Object.keys(opts.clickIdentifier));var clickedElmnt=trkknSettings.closestElement(e.target,opts.clickSelector);if(clickedParent!==null&&clickedElmnt!==null){var attributesToWrite=trkknSettings.buildAttributesString(clickedParent,opts.clickIdentifier);if(attributesToWrite!==""){if(gtmCfg.debug){console.log("trx:LINKID \tset document.cookie = "+opts.cookieName+"="+attributesToWrite);}
var secureCookieParam="";if(window.location.protocol==="https:"){secureCookieParam=";Secure";}
if(opts.pageTemplate!==false){attributesToWrite=attributesToWrite+"###"+opts.pageTemplate;}
document.cookie=opts.cookieName+"="+attributesToWrite+";path=/"+secureCookieParam;}}}}}
function trkDownloads(opts){var gh=trkHlp;if(!this._downloadtrked){this._downloadtrked=true;}else{return;}
if(!opts){opts={'extensions':[]};}else if(typeof opts['extensions']==='string'){opts['extensions']=opts['extensions'].split(',');}
opts['category']=opts['category']||'Download';gh._liveEvent('a','mousedown',function(e){var el=this;var clickId;if(gtmCfg.linkid.enabled){var clickedParent=trkknSettings.closestElement(e.target,Object.keys(gtmCfg.linkid.clickIdentifier));var clickedElmnt=trkknSettings.closestElement(e.target,gtmCfg.linkid.clickSelector);if(clickedParent!==null&&clickedElmnt!==null){clickId=trkknSettings.buildAttributesString(clickedParent,gtmCfg.linkid.clickIdentifier);}}
if(el.href){var ext=utls.checkFile(el.href,opts['extensions']);if(opts['dynamic']){var extDyn=el.href.match(opts['pattern']);if(extDyn){ext='dynamic';}}
if(ext){utls.trkEvent(opts['category'],ext,el.href,gtmCfg.download.ni,undefined,clickId);utls.trkAwEvent({'event':'trx.download','event_name_trx':opts['category'],'type':ext,'name':el.href.split(/[/]+/).pop().split(/\./)[0],'url':el.href,'link_id':clickId,'gtm.element':e.target});}}});return false;}
function trkPrinting(opts){var afterPrint=function(){var url=document.location.pathname;if(opts.queryParams!==false){if(window.location.search!=""){var match,pl=/\+/g,search=/([^&=]+)=?([^&]*)/g,decode=function(s){return decodeURIComponent(s.replace(pl," "));},query=window.location.search.substring(1);urlParams={};while(match=search.exec(query)){urlParams[decode(match[1])]=decode(match[2]);}
if(opts.queryParams.search(",")!=-1){var qElements=opts.queryParams.split(",");}else{var qElements=new Array();qElements.push(opts.queryParams);}
var added=0;for(var i=0;i<qElements.length;i++){if(typeof urlParams[qElements[i]]!="undefined"){if(added==0){var syn="?";}else{var syn="&";}
url+=syn+qElements[i]+"="+urlParams[qElements[i]];added++;}}}}else{url+=window.location.search;}
if(gtmCfg.debug){("Print tracked: "+url);}
utls.trkEvent(opts.category,url,"",gtmCfg.print.ni,undefined,undefined);utls.trkAwEvent({'event':'trx.print','event_name_trx':opts['category'],'url':document.location.href,'link_id':null,'gtm.element':{}});};if(window.matchMedia){var mediaQueryList=window.matchMedia('print');mediaQueryList.addListener(function(mql){if(!mql.matches){afterPrint();}});}else{window.onafterprint=afterPrint;}}
function trkForms(opts){var scp=this;if(typeof opts!=='object'){opts={};}
opts['category']=opts['category']||'Form traking';var trkField=function(e){var el=e.target;var el_value=null;var el_name=el.name||el.id||el.type||el.nodeName;var form_name=utls.getFormName(el);var action='form ('+form_name+')';var label=el_name+' ('+e.type+')';var awAction=e.type;var clickId;if(gtmCfg.linkid.enabled){var clickedParent=trkknSettings.closestElement(e.target,Object.keys(gtmCfg.linkid.clickIdentifier));var clickedElmnt=trkknSettings.closestElement(e.target,"input,textarea");if(clickedParent!==null&&clickedElmnt!==null){clickId=trkknSettings.buildAttributesString(clickedParent,gtmCfg.linkid.clickIdentifier);}}
if(opts['customAttributeName']&&opts['customAttributeName']!="value"){el_name=el.getAttribute([opts['customAttributeName']])||el.name||el.id||el.type||el.nodeName;}
if(el.type=="checkbox"){if(el.checked){label=el_name+' (checked)';awAction="checked";}else{label=el_name+' (unchecked)';awAction="unchecked";}}else{label=el_name+' ('+e.type+')';awAction=e.type;}
if(typeof opts.values!=="undefined"){for(var i=0;i<opts.values.length;i++){if(el.getAttribute([opts.values[i].formFieldAttributeIdentifier])===opts.values[i].formFieldAttributeValue){var formFieldAttributeToPass=opts.values[i].formFieldAttributeToPass;if(el.nodeName==="SELECT"){var optionSelector=e.target.options[e.target.selectedIndex];if(formFieldAttributeToPass==="text"||formFieldAttributeToPass==="innerText"){el_value=optionSelector[formFieldAttributeToPass];}else{el_value=optionSelector.getAttribute(formFieldAttributeToPass);}}else{el_value=el.getAttribute(formFieldAttributeToPass);}
el_value=el_value.trim();label=el_name+' ('+el_value+')';}}}
utls.trkEvent(opts['category'],action,label,gtmCfg.form.ni,undefined,clickId);utls.trkAwEvent({'event':'trx.form'+"_"+awAction,'event_name_trx':opts['category']+"_"+awAction,'name':form_name,'field':el_name,'type':el.type,'text':el_value,'link_id':clickId,'gtm.element':e.target});};trkHlp._DOMReady(function(){var changeTags=['input','select','textarea','hidden'];var submitTags=['form'];var elements=[];var i,j;for(i=0;i<changeTags.length;i++){elements=document.getElementsByTagName(changeTags[i]);for(j=0;j<elements.length;j++){trkHlp._addEventListener(elements[j],'change',trkField);}}
if(opts.submit){for(i=0;i<submitTags.length;i++){elements=document.getElementsByTagName(submitTags[i]);for(j=0;j<elements.length;j++){trkHlp._addEventListener(elements[j],'submit',trkField);}}}});}
gautls.prototype.trkHtml5Media=function(tag){var self=trkHlp;self._liveEvent(tag,'play',utls.trkHtml5MediaElement);self._liveEvent(tag,'pause',utls.trkHtml5MediaElement);self._liveEvent(tag,'ended',utls.trkHtml5MediaElement);self._liveEvent(tag,'timeupdate',utls.checkHtml5MediaProgress);self._liveEvent(tag,'seeked',utls.checkHtml5MediaProgress);};function trkHtml5Video(opts){if(!this._videotrked){this._videotrked=true;}else{return;}
if(opts.audioEnabled){utls.trkHtml5Media('audio');}
if(opts.videoEnabled){utls.trkHtml5Media('video');}}
var html5VS=[];var html5AU=[];gautls.prototype.checkHtml5MediaProgress=function(e){var autoplay=this.getAttribute("loop")!==null&&this.getAttribute("autoplay")!==null&&this.getAttribute("muted")!==null;if(autoplay&&!gtmCfg.video.html5.autoplay){return}
var mediaTitle=this.getAttribute("data-name")===null?undefined:this.getAttribute("data-name");if(gtmCfg.video.html5.percentages&&typeof gtmCfg.video.html5.percentages==="object"&&gtmCfg.video.html5.percentages.length>0){if(this.tagName==="VIDEO"){if(typeof html5VS[e.target.currentSrc]=="undefined"){html5VS[e.target.currentSrc]=[];}
var vLength=e.target.duration;var cTime=e.target.currentTime;var pctgs=[];for(var i in gtmCfg.video.html5.percentages){if(gtmCfg.video.html5.percentages.hasOwnProperty(i)){var tLength=(gtmCfg.video.html5.percentages[i]/100)*vLength;if(cTime>=tLength){var category=gtmCfg.video.html5.category||"video";if(html5VS[e.target.currentSrc].indexOf(gtmCfg.video.html5.percentages[i])==-1){utls.trkEvent(category,gtmCfg.video.html5.percentages[i]+"%",this.currentSrc,gtmCfg.video.html5.ni,mediaTitle,undefined);utls.trkAwEvent({'event':'trx.video_progress','event_name_trx':category+"_progress",'percentage':gtmCfg.video.html5.percentages[i]+"",'duration':Math.round(vLength),'url':this.currentSrc,'name':mediaTitle,'provider':"html5",'link_id':null,'gtm.element':e.target});html5VS[e.target.currentSrc].push(gtmCfg.video.html5.percentages[i]);}}}}}}
if(gtmCfg.audio.percentages&&typeof gtmCfg.audio.percentages==="object"&&gtmCfg.audio.percentages.length>0){if(this.tagName==="AUDIO"){if(typeof html5AU[e.target.currentSrc]=="undefined"){html5AU[e.target.currentSrc]=[];}
var aLength=e.target.duration;var acTime=e.target.currentTime;var pctgs=[];for(var i in gtmCfg.audio.percentages){if(gtmCfg.audio.percentages.hasOwnProperty(i)){var atLength=(gtmCfg.audio.percentages[i]/100)*aLength;if(acTime>=atLength){var category=gtmCfg.audio.category||"audio";if(html5AU[e.target.currentSrc].indexOf(gtmCfg.audio.percentages[i])==-1){utls.trkEvent(category,gtmCfg.audio.percentages[i]+"%",this.currentSrc,gtmCfg.audio.ni,mediaTitle,undefined);utls.trkAwEvent({'event':'trx.audio_progress','event_name_trx':category+"_progress",'percentage':gtmCfg.video.html5.percentages[i]+"",'duration':Math.round(aLength),'url':this.currentSrc,'name':mediaTitle,'provider':"html5",'link_id':null,'gtm.element':e.target});html5AU[e.target.currentSrc].push(gtmCfg.audio.percentages[i]);}}}}}}};gautls.prototype.trkHtml5MediaElement=function(e){if(e.type=="pause"&&e.target.duration==e.target.currentTime){return}
var category=this.tagName;if(category==="VIDEO"){var autoplay=this.getAttribute("loop")!==null&&this.getAttribute("autoplay")!==null&&this.getAttribute("muted")!==null;if(autoplay&&!gtmCfg.video.html5.autoplay){return}
var mediaTitle=this.getAttribute("data-name")===null?undefined:this.getAttribute("data-name");category=gtmCfg.video.html5.category||"video";utls.trkAwEvent({'event':"trx.video_"+e.type,'event_name_trx':category+"_"+e.type,'percentage':e.type==="ended"?"100":Math.round((e.target.currentTime/e.target.duration)*100)+'','duration':Math.round(e.target.duration),'url':this.currentSrc,'name':mediaTitle,'provider':"html5",'link_id':null,'gtm.element':e.target});utls.trkEvent(category,e.type,this.currentSrc,gtmCfg.video.html5.ni,mediaTitle,undefined);}
if(category==="AUDIO"){category=gtmCfg.audio.category||"audio";utls.trkAwEvent({'event':"trx.audio_"+e.type,'event_name_trx':category+"_"+e.type,'percentage':e.type==="ended"?"100":Math.round((e.target.currentTime/e.target.duration)*100)+'','duration':Math.round(e.target.duration),'url':this.currentSrc,'name':mediaTitle,'provider':"html5",'link_id':null,'gtm.element':e.target});utls.trkEvent(category,e.type,this.currentSrc,gtmCfg.audio.ni,mediaTitle,undefined);}};function trkMailto(opts){if(!this._mailTotrked){this._mailTotrked=true;}else{return;}
if(!opts){opts={};}
opts['category']=opts['category']||'Mailto';trkHlp._liveEvent('a','mousedown',function(e){var el=this;var clickId;if(gtmCfg.linkid.enabled){var clickedParent=trkknSettings.closestElement(e.target,Object.keys(gtmCfg.linkid.clickIdentifier));var clickedElmnt=trkknSettings.closestElement(e.target,gtmCfg.linkid.clickSelector);if(clickedParent!==null&&clickedElmnt!==null){clickId=trkknSettings.buildAttributesString(clickedParent,gtmCfg.linkid.clickIdentifier);}}
if(el&&el.href&&el.href.toLowerCase&&sindexOf.call(el.href.toLowerCase(),'mailto:')===0){utls.trkEvent(opts['category'],el.href.substr(7),"",gtmCfg.mailto.ni,undefined,clickId);utls.trkAwEvent({'event':'trx.mailto','event_name_trx':opts['category'],'address':el.href.substr(7),'link_id':clickId,'gtm.element':e.target});}});return false;}
function trkOutboundLinks(opts){if(!this._outboundtrked){this._outboundtrked=true;}else{return;}
var gh=trkHlp;if(!opts){opts={};}
opts['category']=opts['category']||'Outbound';gh._liveEvent('a','mousedown',function(e){var l=this;var clickId;if(gtmCfg.linkid.enabled){var clickedParent=trkknSettings.closestElement(e.target,Object.keys(gtmCfg.linkid.clickIdentifier));var clickedElmnt=trkknSettings.closestElement(e.target,gtmCfg.linkid.clickSelector);if(clickedParent!==null&&clickedElmnt!==null){clickId=trkknSettings.buildAttributesString(clickedParent,gtmCfg.linkid.clickIdentifier);}}
var category=opts['category'];var ext=utls.checkFile(l.href,opts['extensions']);if(ext){return;}
if(l.hasAttribute("href")&&(l.protocol==='whatsapp:'||l.protocol==='http:'||l.protocol==='https:')&&sindexOf.call(l.hostname,document.location.hostname)===-1){var path=(l.pathname+l.search+''),utm=sindexOf.call(path,'__utm');if(utm!==-1){path=path.substring(0,utm);}
path=path.replace(/(\?|&|#)(_gl|_ga|utm_)=.*/i,'');var inboundPattern=gtmCfg.outbound.inboundPattern;if(typeof inboundPattern==="string"){inboundPattern=new RegExp(inboundPattern,"i")}
if(gtmCfg.outbound.inbound!=null&&gtmCfg.outbound.inbound==true&&inboundPattern.test(l.href)){if(gtmCfg.debug){console.log("trx:OUTBOUND \tOutbound Link -> Inbound");}
category=gtmCfg.outbound.inboundCategory;}
if(opts.social){var sharer=false;for(i=0;i<opts.networks.length;i++){var currentNetwork=opts.networks[i];if(sindexOf.call(l.protocol+l.hostname+l.pathname+l.search,currentNetwork.url)>-1){category=gtmCfg.social.category;path=currentNetwork.name;if(l.protocol==="whatsapp:"){paramUrl=utls.qs(l.href,currentNetwork.param);paramUrl=decodeURIComponent(paramUrl.match(/.*(http[^ ]+).*/i)[1]);}else{paramUrl=utls.qs(l.href,currentNetwork.param);}
sharer=true;break;}}
if(sharer){if(opts.trkAsSocial){utls.trkSocial(path,"share",paramUrl,gtmCfg.social.ni,undefined,clickId);}
if(opts.trkAsEvent){utls.trkEvent(category,path,paramUrl,gtmCfg.social.ni,undefined,clickId);utls.trkAwEvent({'event':'trx.share','event_name_trx':category,'provider':path,'url':paramUrl,'link_id':clickId,'gtm.element':e.target});}}else{utls.trkEvent(category,l.hostname,path,gtmCfg.outbound.ni,undefined,clickId);utls.trkAwEvent({'event':'trx.outbound','event_name_trx':category,'domain':l.hostname,'url':l.protocol+'//'+l.hostname+path,'link_id':clickId,'gtm.element':e.target});}}else{utls.trkEvent(category,l.hostname,path,gtmCfg.outbound.ni,undefined,clickId);utls.trkAwEvent({'event':'trx.outbound','event_name_trx':category,'domain':l.hostname,'url':l.protocol+'//'+l.hostname+path,'link_id':clickId,'gtm.element':e.target});}}});}
function trkTelto(opts){if(!this._telTotrked){this._telTotrked=true;}else{return;}
if(!opts){opts={};}
opts['category']=opts['category']||'Telto';trkHlp._liveEvent('a','mousedown',function(e){var el=this;var clickId;if(gtmCfg.linkid.enabled){var clickedParent=trkknSettings.closestElement(e.target,Object.keys(gtmCfg.linkid.clickIdentifier));var clickedElmnt=trkknSettings.closestElement(e.target,gtmCfg.linkid.clickSelector);if(clickedParent!==null&&clickedElmnt!==null){clickId=trkknSettings.buildAttributesString(clickedParent,gtmCfg.linkid.clickIdentifier);}}
if(el&&el.href&&el.href.toLowerCase&&sindexOf.call(el.href.toLowerCase(),'tel:')===0){utls.trkEvent(opts['category'],el.href.substr(4),"",gtmCfg.telto.ni,undefined,clickId);utls.trkAwEvent({'event':'trx.telto','event_name_trx':opts['category'],'number':el.href.substr(4),'link_id':clickId,'gtm.element':e.target});}});return false;}
function trkCopyText(opts){if(!this._trkCopyText){this._trkCopyText=true;}else{return;}
var gh=trkHlp;if(!opts){opts={};}
opts['category']=opts['category']||'Copy Text';opts['textlength']=parseInt(opts['textlength'])||50;gh._addEventListener(document,'copy',function(e){var clickId;if(gtmCfg.linkid.enabled){var clickedParent=trkknSettings.closestElement(e.target,Object.keys(gtmCfg.linkid.clickIdentifier));var clickedElmnt=trkknSettings.closestElement(e.target,'html');if(clickedParent!==null&&clickedElmnt!==null){clickId=trkknSettings.buildAttributesString(clickedParent,gtmCfg.linkid.clickIdentifier);}}
var ttn=e.target.tagName;var nocopy=ttn.match(/(textarea|input)/gi);var text=getSelectionText();if(text.length>0&&nocopy==null){utls.trkEvent(opts['category'],text.length,text.substr(0,opts["textlength"]),gtmCfg.copytext.ni,undefined,clickId);utls.trkAwEvent({'event':'trx.copytext','event_name_trx':opts['category'],'text':text.substr(0,opts["textlength"]),'count':text.length,'link_id':clickId,'gtm.element':e.target});}},false);return false;}
function getSelectionText(){var text="";if(window.getSelection){text=window.getSelection().toString();}else if(document.selection&&document.selection.type!="Control"){text=document.selection.createRange().text;}
return text;}
var vimeoTimeTriggers=[];var vimeoPoolMaps={};var vimeo_urls={};gautls.prototype.vimeoPool=function(data){if(!vimeoPoolMaps[data.player_id]){vimeoPoolMaps[data.player_id]={};vimeoPoolMaps[data.player_id].timeTriggers=slice.call(vimeoTimeTriggers);}
if(vimeoPoolMaps[data.player_id].timeTriggers.length>0){if(data.data.percent*100>=vimeoPoolMaps[data.player_id].timeTriggers[0]){var action=vimeoPoolMaps[data.player_id].timeTriggers.shift();utls.trkEvent(gtmCfg.video.vimeo.category,action+'%',vimeo_urls[data.player_id],gtmCfg.video.vimeo.ni,undefined,undefined);utls.trkAwEvent({'event':"trx.video_progress",'event_name_trx':gtmCfg.video.vimeo.category+"_progress",'percentage':action+'','duration:':data.data.duration,'url':vimeo_urls[data.player_id],'provider':"vimeo",'link_id':null,'gtm.element':{}});}}};gautls.prototype.vimeoPostMessage=function(method,params,target){if(!target.contentWindow||!target.contentWindow.postMessage||!JSON){return false;}
var url=target.getAttribute('src').split('?')[0],data=JSON.stringify({method:method,value:params});target.contentWindow.postMessage(data,url);return true;};var _hasvimeo_window_event=false;var vimeoOpts;gautls.prototype.vimeoPostMessageListener=function(event){if(sindexOf.call(event.origin,'//player.vimeo.com')>-1){var data=JSON.parse(event.data);if(data.event==='ready'){utls.trkVimeo(trkHlp);}else if(data.method){if(data.method==='getVideoUrl'){if(document.getElementById(data.player_id)){var videoUrl=document.getElementById(data.player_id).src;videoUrl=videoUrl.substring(0,videoUrl.indexOf("?"));vimeo_urls[data.player_id]=videoUrl;}}}else if(data.event==='playProgress'){utls.vimeoPool(data);}else{var clickId;if(gtmCfg.linkid.enabled){var clickedParent=trkknSettings.closestElement(event['target']['f'],Object.keys(gtmCfg.linkid.clickIdentifier));var clickedElmnt=trkknSettings.closestElement(event['target']['f'],'iframe');if(clickedParent!==null&&clickedElmnt!==null){clickId=trkknSettings.buildAttributesString(clickedParent,gtmCfg.linkid.clickIdentifier);}}
if(data.event==="finish"){data.event="ended"}
utls.trkEvent(vimeoOpts['category'],data.event,vimeo_urls[data.player_id],gtmCfg.video.vimeo.ni,undefined,undefined);utls.trkAwEvent({'event':"trx.video_"+data.event,'event_name_trx':vimeoOpts['category']+"_"+data.event,'percentage':data.event==="ended"?"100":Math.round(data.data.percent*100)+'','duration':Math.round(data.data.duration),'url':vimeo_urls[data.player_id],'provider':"vimeo",'link_id':null,'gtm.element':{}});}}};gautls.prototype.trkVimeo=function(gh){var iframes=document.getElementsByTagName('iframe');var vimeo_videos=0;var player_id;var player_src;var separator;var force=vimeoOpts['force'];var partials=vimeoOpts['percentages'];for(var i=0;i<iframes.length;i++){if(typeof iframes[i].src=="string"&&sindexOf.call(iframes[i].src,'//player.vimeo.com')>-1){player_src=iframes[i].src;if(sindexOf.call(player_src,'http://')>-1){player_src=player_src.replace("http://","https://");iframes[i].src=player_src;}
if(sindexOf.call(player_src,'//')==0){player_src=player_src.replace("//","https://");iframes[i].src=player_src;}
player_id='gasvimeo_'+vimeo_videos;separator='?';if(sindexOf.call(player_src,'?')>-1){separator='&';}
if(sindexOf.call(player_src,'api=1')<0){if(force){player_src+=separator+'api=1&player_id='+player_id;}else{}}else{if(sindexOf.call(player_src,'player_id=')<-1){player_src+=separator+'player_id='+player_id;}}
vimeo_videos++;iframes[i].id=player_id;if(iframes[i].src!==player_src){iframes[i].src=player_src;break;}
utls.vimeoPostMessage('getVideoUrl','',iframes[i]);utls.vimeoPostMessage('addEventListener','play',iframes[i]);utls.vimeoPostMessage('addEventListener','pause',iframes[i]);utls.vimeoPostMessage('addEventListener','finish',iframes[i]);if(partials){vimeoTimeTriggers=partials;utls.vimeoPostMessage('addEventListener','playProgress',iframes[i]);}}}
if(vimeo_videos>0&&_hasvimeo_window_event===false){gh._addEventListener(window,'message',utls.vimeoPostMessageListener,false);_hasvimeo_window_event=true;}};function trkVimeoVideo(opts){var gh=trkHlp;if(typeof opts==='boolean'||opts==='force'){opts={'force':!!opts};}
opts=opts||{};opts['category']=gtmCfg.video.vimeo.category;opts['percentages']=opts['percentages']||[];opts['force']=opts['force']||false;vimeoOpts=opts;gh._DOMReady(function(){utls.trkVimeo(gh);});return false;}
function trkMovingImages(opts){opts=opts||{};opts['force']=opts['force']||false;opts['category']=opts['category']||'mi24 video';var scripts=document.querySelectorAll("script[src*='edge-cdn.net/videojs_']");for(var m=0;m<scripts.length;m++){var src=scripts[0].src;var match=src.match(/\d{6,}/);if(match.length>0){var id=match[0];eval('var checkExist = setInterval(function() {if(typeof mi24player_'+id+' !== "undefined"){utls.trkRegisterFunctionsMI('+id+',"'+opts["category"]+'");clearInterval(checkExist);}},100);');}}}
gautls.prototype.trkRegisterFunctionsMI=function(id,category){eval('mi24player_'+id+'.registerStatusFunction("play",\'utls.trkImageVideoEvent("play",'+id+',"'+category+'")\');');eval('mi24player_'+id+'.registerStatusFunction("pause",\'utls.trkImageVideoEvent("pause",'+id+',"'+category+'")\');');eval('mi24player_'+id+'.registerStatusFunction("ended",\'utls.trkImageVideoEvent("finish",'+id+',"'+category+'")\');');};gautls.prototype.trkImageVideoEvent=function(status,playerId,category){utls.trkEvent(category,status,playerId,video.mi24.ni,undefined,undefined);utls.trkAwEvent({'event':"trx.video_"+status,'event_name_trx':category+"_"+status,'percentage':undefined,'url':playerId,'provider':"mi24",'link_id':null,'gtm.element':{}});};var youTubeTimeTriggers=[];var youTubeOpts;var youTubePoolMaps={};function trkYouTubeVideo(opts){opts=opts||{};opts['force']=opts['force']||false;opts['category']=opts['category']||'youtube video';opts['percentages']=opts['percentages']||[];youTubeOpts=opts;var gh=trkHlp;gh._DOMReady(function(){utls.trkYouTube(gh,opts);});return false;}
gautls.prototype.trkYouTube=function(helper,opts){var force=opts['force'];var opt_timeTriggers=opts['percentages'];if(force){try{utls.youtubeMigrateObjectEmbed();}catch(e){utls.trkEvent('Exception',e,'error youtube.js:youTubeMigrateObjectEmbed',true,undefined,undefined);utls.trkAwEvent({'event':"trx.error",'event_name_trx':"error",'description':e,'name':'youtube.js:youTubeMigrateObjectEmbed','link_id':null,'gtm.element':{}});}}
var youtube_videos=[];var iframes=document.getElementsByTagName('iframe');for(var i=0;i<iframes.length;i++){if(typeof(iframes[i].src)=="string"){if(sindexOf.call(iframes[i].src,'//www.youtube.com/embed')>-1||sindexOf.call(iframes[i].src,'//www.youtube-nocookie.com/embed')>-1){if(sindexOf.call(iframes[i].src,'enablejsapi=1')<0){if(force){if(sindexOf.call(iframes[i].src,'?')<0){iframes[i].src+='?enablejsapi=1';}else{iframes[i].src+='&enablejsapi=1';}}else{continue;}}
youtube_videos.push(iframes[i]);}}}
if(youtube_videos.length>0){if(opt_timeTriggers&&opt_timeTriggers.length){youTubeTimeTriggers=opt_timeTriggers;}
window.onYouTubeIframeAPIReady=function(){};var iframe_api_included=false;var iframe_api_loaded=false;var scripts=document.getElementsByTagName('script');for(var i=0;i<scripts.length;i++){if(scripts[i].src.indexOf("//www.youtube.com/iframe_api")>=0){iframe_api_included=true;if(typeof YT!=="undefined"&&YT.loaded){iframe_api_loaded=true;}};};if(iframe_api_loaded){var p;for(var i=0;i<youtube_videos.length;i++){p=new window['YT']['Player'](youtube_videos[i]);p.addEventListener('onStateChange',utls.youTubeStateChange);p.addEventListener('onError',utls.youTubeError);}}else{window['onYouTubePlayerAPIReady']=function(){var p;for(var i=0;i<youtube_videos.length;i++){p=new window['YT']['Player'](youtube_videos[i]);p.addEventListener('onStateChange',utls.youTubeStateChange);p.addEventListener('onError',utls.youTubeError);}};if(!iframe_api_included){var tag=document.createElement('script');var protocol='http:';if(document.location.protocol==='https:'){protocol='https:';}
tag.src=protocol+'//www.youtube.com/iframe_api';tag.type='text/javascript';tag.async=true;var firstScriptTag=document.getElementsByTagName('script')[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag);}}}};gautls.prototype.youtubeMigrateObjectEmbed=function(){var objs=document.getElementsByTagName('object');var pars,ifr,ytid;var r=/(https?:\/\/www\.youtube(-nocookie)?\.com[^\/]*).*\/v\/([^&?]+)/;for(var i=0;i<objs.length;i++){pars=objs[i].getElementsByTagName('param');for(var j=0;j<pars.length;j++){if(pars[j].name==='movie'&&pars[j].value){ytid=pars[j].value.match(r);if(ytid&&ytid[1]&&ytid[3]){ifr=document.createElement('iframe');ifr.src=ytid[1]+'/embed/'+ytid[3]+'?enablejsapi=1';ifr.width=objs[i].width;ifr.height=objs[i].height;ifr.setAttribute('frameBorder','0');ifr.setAttribute('allowfullscreen','');objs[i].parentNode.insertBefore(ifr,objs[i]);objs[i].parentNode.removeChild(objs[i]);i--;}
break;}}}};gautls.prototype.youTubePool=function(target,hash){if(youTubePoolMaps[hash]===undefined||youTubePoolMaps[hash].timeTriggers.length<=0){return false;}
var p=target['getCurrentTime']()/target['getDuration']()*100;if(p>=youTubePoolMaps[hash].timeTriggers[0]){var action=youTubePoolMaps[hash].timeTriggers.shift();var cleanUrl=utls.youTubeGetVideoData(target,"cleanUrl");var title=utls.youTubeGetVideoData(target,"title");if(gtmCfg.video.youTube.videoTitle){utls.trkEvent(youTubeOpts['category'],action+'%',title,gtmCfg.video.youTube.ni,cleanUrl,undefined);}else{utls.trkEvent(youTubeOpts['category'],action+'%',cleanUrl,gtmCfg.video.youTube.ni,title,undefined);}
utls.trkAwEvent({'event':"trx.video_progress",'event_name_trx':youTubeOpts['category']+"_progress",'percentage':action+'','duration':Math.round(target['getDuration']()),'url':cleanUrl,'name':title,'provider':"youtube",'link_id':null,'gtm.element':{}});}
youTubePoolMaps[hash].timer=setTimeout(utls.youTubePool,1000,target,hash);};gautls.prototype.youTubeStopPool=function(target){var h=target['getVideoUrl']();if(youTubePoolMaps[h]&&youTubePoolMaps[h].timer){utls.youTubePool(target,h);clearTimeout(youTubePoolMaps[h].timer);}};gautls.prototype.youTubeGetVideoData=function(target,data){if(data==="cleanUrl"){return target['getVideoUrl']().replace(/\A?t=[^&]+&*/,"");}
if(data==="url"){return target['getVideoUrl']();}
var vDatas=target['getVideoData']();if(vDatas.hasOwnProperty(data)){return vDatas[data];}else{console.log("trx:YOUTUBE \tyouTubeGetVideoData "+data+" not available");}}
gautls.prototype.youTubeStartPool=function(target){if(youTubeTimeTriggers&&youTubeTimeTriggers.length){var h=utls.youTubeGetVideoData(target,"video_id");if(youTubePoolMaps[h]){utls.youTubeStopPool(target);}else{youTubePoolMaps[h]={};youTubePoolMaps[h].timeTriggers=slice.call(youTubeTimeTriggers);}
youTubePoolMaps[h].timer=setTimeout(utls.youTubePool,1000,target,h);}};gautls.prototype.youTubeStateChange=function(event){var action='';switch(event['data']){case 0:action='ended';utls.youTubeStopPool(event['target']);break;case 1:action='play';utls.youTubeStartPool(event['target']);break;case 2:action='pause';utls.youTubeStopPool(event['target']);break;}
if(action){var cleanUrl=utls.youTubeGetVideoData(event['target'],"cleanUrl");var title=utls.youTubeGetVideoData(event['target'],"title");if(gtmCfg.video.youTube.videoTitle){utls.trkEvent(youTubeOpts['category'],action,title,gtmCfg.video.youTube.ni,cleanUrl,undefined);}else{utls.trkEvent(youTubeOpts['category'],action,cleanUrl,gtmCfg.video.youTube.ni,title,undefined);}
utls.trkAwEvent({'event':"trx.video_"+action,'event_name_trx':youTubeOpts['category']+"_"+action,'percentage':action==="ended"?"100":Math.round((event['target'].getCurrentTime()/event['target'].getDuration())*100)+'','duration':Math.round(event['target'].getDuration()),'url':cleanUrl,'name':title,'provider':"youtube",'link_id':null,'gtm.element':{}});}};gautls.prototype.youTubeError=function(event){utls.trkEvent(youTubeOpts['category'],'error ('+event['data']+')',event['target']['getVideoUrl'](),gtmCfg.video.youTube.ni,undefined,undefined);utls.trkAwEvent({'event':"trx.error",'event_name_trx':"error",'name':event['data'],'url':event['target']['getVideoUrl'](),'provider':"youtube",'link_id':null,'gtm.element':{}});};function trkScroll(opts){if(!this._trkScroll){if(opts.method==="onPercentage"){this.trkd=[];window.addEventListener("scroll",debounce(scrollPerc,250));}
if(opts.method==="onUnload"){if(typeof this._trkScroll==="undefined"){this.bodyScrollHeight;this.maxscrolled=0;this.initialPercent=Math.round(window.innerHeight/document.body.scrollHeight*100);if(this.initialPercent>100){this.initialPercent=100;}
this.initialPercentThreshold=Math.round(this.initialPercent/10)*10+"";window.addEventListener("scroll",debounce(onUnloadScroll.bind(this),250));window.addEventListener("beforeunload",onUnloadFire.bind(this));}
if(this._trkScroll===false){onUnloadFire(true);}}
this._trkScroll=true;}else{return;}
function debounce(fnc,wait,immediate){var timeout;return function(){var context=this,args=arguments;var later=function(){timeout=null;if(!immediate)fnc.apply(context,args);};var callNow=immediate&&!timeout;clearTimeout(timeout);timeout=setTimeout(later,wait);if(callNow)fnc.apply(context,args);};};function scrollPerc(){var doc=document.documentElement;var bdy=document.body;var scT="scrollTop";var scH="scrollHeight";var lim=opts['percentage'];var ni=opts['ni'];var pct=Math.ceil((doc[scT]||bdy[scT])/((doc[scH]||bdy[scH])-doc.clientHeight)*100);for(var i=0;i<lim.length;i++){if(pct>=lim[i]&&this.trkd.indexOf(lim[i])===-1){this.trkd.push(lim[i]);this.trkd.push(ni[i]);utls.trkEvent(opts['category'],'percentage',lim[i]+'%',ni[i],undefined,undefined);utls.trkAwEvent({'event':'trx.scroll','event_name_trx':opts['category'],'percentage':lim[i]+'','link_id':null,'gtm.element':{}});}}};function onUnloadScroll(){var scrollpoint=(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0)+window.innerHeight;if(this.maxscrolled<scrollpoint){this.maxscrolled=scrollpoint;}
this.bodyScrollHeight=document.body.scrollHeight;}
function onUnloadFire(virtual){var pixelScrolled=this.maxscrolled-window.innerHeight;var percent=(Math.round(this.maxscrolled/this.bodyScrollHeight*100));if(percent>100){percent=100;}
var percentThreshold=Math.round(percent/10)*10+"";var ni=true;if(percent>=opts.niFromPercent){ni=false;}
if(pixelScrolled>=opts.trackFromPixel){utls.trkEvent(opts['category'],"max_viewed: "+percentThreshold+"%","initially_viewed: "+this.initialPercentThreshold+"%",ni,this.initialPercent,undefined,percent);utls.trkAwEvent({'event':'trx.scroll','event_name_trx':opts['category'],'page_virtual_location':virtual&&typeof gtmCfg.spaPreviousLocation!=="undefined"?gtmCfg.spaPreviousLocation:undefined,'percentage':percentThreshold,'percentage_num':percent,'initial_percentage':this.initialPercentThreshold,'initial_percentage_num':this.initialPercent,'link_id':null,'gtm.element':{}});}
this.maxscrolled=0;this.initialPercent=Math.round(window.innerHeight/document.body.scrollHeight*100);if(this.initialPercent>100){this.initialPercent=100;}
this.initialPercentThreshold=Math.round(this.initialPercent/10)*10+"";}}
var trkHlp;var utls;var gtmCfg;var extensionLoaded;function initialize(){trkHlp=new GasHelper();utls=new gautls();if(gtmCfg.linkid.enabled){window.trkknSettings.linkIdSettings=gtmCfg.linkid;var options={clickIdentifier:gtmCfg.linkid.clickIdentifier,clickSelector:gtmCfg.linkid.clickSelector,cookieName:gtmCfg.linkid.cookieName,pageTemplate:gtmCfg.linkid.pageTemplate,pushListenerEvents:gtmCfg.linkid.pushListenerEvents};trkLinkId(options);}
if(gtmCfg.trackHash){var pattern=/#r=(.+?&|.*$)/;var matches=pattern.exec(window.location.hash);if(matches&&document.referrer!==""){var linkAction=matches[1].replace("&","");utls.trkEvent(gtmCfg.trackHash.category,linkAction,document.referrer,gtmCfg.trackHash.ni,undefined,undefined);utls.trkAwEvent({'event':'trx.links','event_name_trx':gtmCfg.trackHash.category,'name':linkAction,'referrer':document.referrer,'link_id':null,'gtm.element':{}});}}
if(gtmCfg.download.enabled){var options={extensions:gtmCfg.download.extensions,category:gtmCfg.download.category,dynamic:gtmCfg.download.dynamicDownload,pattern:gtmCfg.download.pattern};trkDownloads(options);}
if(gtmCfg.form.enabled){var options={category:gtmCfg.form.category,submit:gtmCfg.form.submit,values:gtmCfg.form.values};if(gtmCfg.form.customAttributeAsNameField.enabled){options.customAttributeName=gtmCfg.form.customAttributeAsNameField.name;};trkForms(options);}
if(gtmCfg.video.enabled){if(gtmCfg.video.vimeo.enabled){trkVimeoVideo({percentages:gtmCfg.video.vimeo.percentages,category:gtmCfg.video.vimeo.category,force:true});}
if(gtmCfg.video.youTube.enabled){trkYouTubeVideo({percentages:gtmCfg.video.youTube.percentages,category:gtmCfg.video.youTube.category,force:true});}
if(gtmCfg.video.mi24.enabled){trkMovingImages({category:gtmCfg.video.mi24.category,force:true});}
if(gtmCfg.video.html5.enabled||gtmCfg.audio.enabled){trkHtml5Video({audioEnabled:gtmCfg.audio.enabled,audioCategory:gtmCfg.audio.category,videoEnabled:gtmCfg.video.html5.enabled,videoCategory:gtmCfg.video.html5.category});}}
if(gtmCfg.mailto.enabled){var options={category:gtmCfg.mailto.category};trkMailto(options);}
if(gtmCfg.outbound.enabled){options={category:gtmCfg.outbound.category,social:gtmCfg.social.enabled,networks:gtmCfg.social.outboundSocialNetworks,trkAsSocial:gtmCfg.social.trackAsSocial,trkAsEvent:gtmCfg.social.trackAsEvent,extensions:gtmCfg.download.extensions};trkOutboundLinks(options);}
if(gtmCfg.telto.enabled){var options={category:gtmCfg.telto.category};trkTelto(options);}
if(gtmCfg.copytext.enabled){var options={category:gtmCfg.copytext.category,textlength:gtmCfg.copytext.textlength};trkCopyText(options);}
if(gtmCfg.scroll.enabled){var options={method:gtmCfg.scroll.method,category:gtmCfg.scroll.category,percentage:gtmCfg.scroll.percentage,ni:gtmCfg.scroll.ni,trackFromPixel:gtmCfg.scroll.trackFromPixel,niFromPercent:gtmCfg.scroll.niFromPercent};trkScroll(options);}
if(gtmCfg.debug){console.log("trx:GTM Init");}
gtmCfg.dataLayer.push({'event':'trx.initialized','trx_version':'js:'+trx_version+',tpl:'+(typeof gtmCfg.tplVersion==="undefined"?'2.4':gtmCfg.tplVersion)});}
if(gtmCfg.print.enabled){var options={category:gtmCfg.print.category,queryParams:gtmCfg.print.queryParams};trkPrinting(options);}
if(sessionStorage.getItem('trx_geo_weather')===null){function trkext_geo_weather_ip(c){var geoWthr={};function pushObj(){geoWthr["event"]="geo_weather_ip";if(typeof c.geoPluginIp!=="undefined"){if(c.weatherEnabled){var ipRequest=propertyPath(geoWthr,"trx_geo."+c.geoPluginIp);}else{var ipRequest=propertyPath(geoWthr,"trx_geo_weather."+c.geoPluginIp);}
var ipComp=compareIP(ipRequest,c.geoIpAdressList);geoWthr["trx_ip"]=ipComp;if(window.localStorage.getItem('trx_ip')!=="internal"){window.localStorage.setItem('trx_ip',ipComp);}else{geoWthr["trx_ip"]="internal";}}
for(var i=0;i<c.deletePiiData.length;i++){propertyPath(geoWthr,c.deletePiiData[i],true);}
gtmCfg.dataLayer.push(JSON.parse(JSON.stringify(geoWthr)));if(c.sessionStorage){if(c.weatherEnabled){delete geoWthr["event"];delete geoWthr["trx_ip"];window.sessionStorage.setItem('trx_geo_weather',JSON.stringify(geoWthr));}else{window.sessionStorage.setItem('trx_geo_weather',JSON.stringify(geoWthr["trx_geo_weather"]));}}else{window.sessionStorage.setItem('trx_geo_weather',true);}}
function getXMLData(pluginURL,pluginType,lat,lon){if(pluginType==="wthr"){pluginURL=pluginURL+'&'+c.weatherPluginLatParam+'='+lat+'&'+c.weatherPluginLonParam+'='+lon;}
var xmlhttp=new XMLHttpRequest();xmlhttp.open('GET',pluginURL,true);xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState===4){if(xmlhttp.status===200){var rt=JSON.parse(xmlhttp.responseText);if(pluginType==="geo"){if(c.weatherEnabled){geoWthr["trx_geo"]=rt;getXMLData(c.weatherPluginURL,"wthr",rt[c.geoPluginLatKey],rt[c.geoPluginLonKey]);}else{geoWthr["trx_geo_weather"]=rt;pushObj();}}
if(pluginType==="wthr"){geoWthr["trx_weather"]=rt;pushObj();}}else{return false;}}};xmlhttp.send(null);}
getXMLData(c.geoPluginURL,"geo");}}
function ipRangeBetween(x,minMax){x=Number(x);minMax=minMax.split("-");return x>=Number(minMax[0])&&x<=Number(minMax[1]);}
function compareIP(ip,ipl){for(var z=0;z<ipl.length;z++){if(ipl[z].indexOf("-")!==-1){var ipComp=true;var oip=ip.split(".");var cip=ipl[z].split(".");for(var y=0;y<cip.length;y++){if(cip[y].indexOf("-")!==-1){ipComp=ipRangeBetween(oip[y],cip[y]);}else if(oip[y]!==cip[y]){ipComp=false;break;}}
if(ipComp){return"internal";}}
if(ipl[z]===ip){return"internal";}}
return"external";}
function propertyPath(obj,path,del){if(!obj||!path){return;}
if(typeof path==='string'){path=path.split('.');}
for(var i=0;i<path.length-1;i++){obj=obj[path[i]];if(typeof obj==='undefined'){return;}}
if(del){delete obj[path.pop()];}else{return obj[path.pop()];}};extensionLoaded=true;if(typeof(gtmCfg)!=='undefined'){if(typeof(gtmCfg)==='object'){gtmCfg.spaInitialLocation=window.location.href;gtmCfg.spaPreviousLocation=undefined;gtmCfg.spaCurrentLocation=window.location.href;}
initialize();gtmCfg.dataLayer.push({'event':'trx.loaded','trx_version':'js:'+trx_version+',tpl:'+gtmCfg.tplVersion});}